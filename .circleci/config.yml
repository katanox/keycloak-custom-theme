# Use the latest 2.1 version of CircleCI pipeline process engine.
# See: https://circleci.com/docs/2.0/configuration-reference
version: 2.1

# executors:
#   node-cypress:
#     docker:
#       - image: "cypress/browsers:node16.14.0-chrome99-ff97"

# orbs:
#   # The Node.js orb contains a set of prepackaged CircleCI configuration you can utilize
#   # Orbs reduce the amount of configuration required for common tasks.
#   # See the orb documentation here: https://circleci.com/developer/orbs/orb/circleci/node
#   node: circleci/node@5
#   cypress: cypress-io/cypress@2.1.0

jobs:
  build-jar:
    docker:
      - image: cimg/openjdk:21.0.2
    steps:
      - checkout
      - attach_workspace:
          at: ~/workspace
      - run: ./package.sh
      - persist_to_workspace:
          root: .
          paths:
            - providers

workflows:
  publish-preview:
    jobs:
      - build-jar
      - hold-release:
          name: hold-release
          type: approval
          requires:
            - build-jar
      - gh/release:
          tag: "1.0.0"
          title: "The initial release"
          notes-file: changelog.md
          context:
            - GITHUB_CREDS
          requires:
            - hold-release